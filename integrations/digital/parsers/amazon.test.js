import { evaluateEmail } from './amazon';

const testMail =
  '<html><head>\r\n<meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta content="text/html; charset=utf-8"><style type="text/css">\r\n<!--\r\n.topHeaderLinks a\r\n\t{text-decoration:none;\r\n\tcolor:#006699;\r\n\tfont-family:Arial,san-serif}\r\n.shipmentDetails\r\n\t{width:640px;\r\n\tpadding:16px 40px}\r\n.shipmentDetails-no-asin\r\n\t{width:640px;\r\n\tpadding:16px 20px}\r\n-->\r\n</style></head><body style="margin:0"><img width="1" height="1" src="https://www.amazon.ca/gp/r.html?C=2JG4V7T7UJ2XJ&amp;K=2U9P9ZOT2WYJ7&amp;M=urn:rtn:msg:2020060211184163c7354fc8904f9a8542fc7a4d40p0na&amp;R=18ZI3L8OTW88L&amp;T=O&amp;U=https%3A%2F%2Fimages-na.ssl-images-amazon.com%2Fimages%2FG%2F01%2Fnav%2Ftransp.gif&amp;H=JD69Q2T15GTFUC1TMADIXA3EBTQA&amp;ref_=pe_3034960_236395000_opens"> <table width="640" cellspacing="0" id="container" cellpadding="0" style="font:12px/16px Arial,sans-serif; color:rgb(51,51,51); background-color:rgb(255,255,255); margin:0 auto"><tbody><tr><td valign="top" id="topNav" style="padding:20px 0px 10px 20px; width:100px; border-collapse:collapse"><a href="https://www.amazon.ca/gp/r.html?C=2JG4V7T7UJ2XJ&amp;K=2U9P9ZOT2WYJ7&amp;M=urn:rtn:msg:2020060211184163c7354fc8904f9a8542fc7a4d40p0na&amp;R=2XLLA1N5VZUGU&amp;T=C&amp;U=https%3A%2F%2Fwww.amazon.ca%2Fref%3Dpe_3034960_236395000_FR_TE_g_i&amp;H=K4WDWCRAEFWS8NNZCRDAPCXLXXCA&amp;ref_=pe_3034960_236395000_FR_TE_g_i" title="Visitez Amazon.ca"><img alt="Amazon" border="0" height="31" id="amazonLogo" src="https://images-na.ssl-images-amazon.com/images/G/15/x-locale/cs/te/a_ca_logo.png" width="107" style="font-size:11px"></a> </td><td style="text-align:right; padding:0px 20px"><table cellspacing="0" id="marketingContent" cellpadding="0" style="font:12px/16px Arial,sans-serif; color:rgb(51,51,51); margin:0 auto; border-collapse:collapse"><tbody><tr><td class="topHeaderLinks" style="border-bottom:1px solid rgb(204,204,204); width:490px"><table align="right" style="font:12px/16px Arial,sans-serif; color:rgb(51,51,51)"><tbody><tr style="padding:5px 0px 5px 0px; white-space:nowrap; border-collapse:collapse; text-align:right; width:490px"><td><a href="https://www.amazon.ca/gp/r.html?C=2JG4V7T7UJ2XJ&amp;K=2U9P9ZOT2WYJ7&amp;M=urn:rtn:msg:2020060211184163c7354fc8904f9a8542fc7a4d40p0na&amp;R=38EBZO6EJ3M0N&amp;T=C&amp;U=https%3A%2F%2Fwww.amazon.ca%2Fgp%2Fcss%2Fyour-orders-access%2Fref%3Dpe_3034960_236395000_FR_TE_oh_tn&amp;H=OUYFAL4ZY10TOKAAHWM99L6SNQAA&amp;ref_=pe_3034960_236395000_FR_TE_oh_tn" style="text-decoration:none; color:#006699; font-family:Arial,san-serif">Vos commandes</a> </td><td><span style="text-decoration:none; color:#CCC; font:15px Arial,san-serif">&nbsp;|&nbsp;</span> </td><td><a href="https://www.amazon.ca/gp/f.html?C=2JG4V7T7UJ2XJ&amp;K=2U9P9ZOT2WYJ7&amp;M=urn:rtn:msg:2020060211184163c7354fc8904f9a8542fc7a4d40p0na&amp;R=3I4ZVVSZ9WOQ&amp;T=C&amp;U=https%3A%2F%2Fwww.amazon.ca%2Fgp%2Fcss%2Fyour-account-access%2Fref%3Dpe_3034960_236395000_FR_TE_ya_tn&amp;H=1K8QI26LARIO6LY4LYYUIZFCA5SA&amp;ref_=pe_3034960_236395000_FR_TE_ya_tn" style="text-decoration:none; color:#006699; font-family:Arial,san-serif">Votre compte</a> </td><td><span style="text-decoration:none; color:#CCC; font:15px Arial,san-serif">&nbsp;|&nbsp;</span> </td><td><a href="https://www.amazon.ca/gp/r.html?C=2JG4V7T7UJ2XJ&amp;K=2U9P9ZOT2WYJ7&amp;M=urn:rtn:msg:2020060211184163c7354fc8904f9a8542fc7a4d40p0na&amp;R=2HVB8GOOT55J5&amp;T=C&amp;U=https%3A%2F%2Fwww.amazon.ca%2Fref%3Dpe_3034960_236395000_FR_TE_g_tn&amp;H=PZEYKUPOYEBDLQP9L4MSR9E45JAA&amp;ref_=pe_3034960_236395000_FR_TE_g_tn" style="text-decoration:none; color:#006699; font-family:Arial,san-serif">Amazon.ca</a> </td></tr></tbody></table></td></tr><tr><td style="padding:7px 0px 0px 20px; text-align:right; width:490px"><span style="font:20px Arial,san-serif">Confirmation de l\'envoi</span> </td></tr><tr><td style="padding:0px 0px 5px 20px; text-align:right; width:490px"><span style="font-size:12px">Commande #<a href="https://www.amazon.ca/gp/r.html?C=2JG4V7T7UJ2XJ&amp;K=2U9P9ZOT2WYJ7&amp;M=urn:rtn:msg:2020060211184163c7354fc8904f9a8542fc7a4d40p0na&amp;R=1M5WK0EY77YR2&amp;T=C&amp;U=https%3A%2F%2Fwww.amazon.ca%2Fgp%2Fcss%2Fsummary%2Fedit.html%2Fref%3Dpe_3034960_236395000_FR_TE_od_tn%3Fie%3DUTF8%26orderID%3D701-1371851-7627833&amp;H=S1SF36IOHDYVQKUJ2FC9IT2DFZQA&amp;ref_=pe_3034960_236395000_FR_TE_od_tn" style="text-decoration:none; color:#006699">701-1371851-7627833</a> </span></td></tr></tbody></table></td></tr><tr><td colspan="2" style="width:640px"><p style="font:18px Arial,sans-serif; color:#cc6600; margin:15px 20px 0 20px">Bonjour John,</p><p style="margin:4px 20px 18px 20px; width:640px">Merci de magasiner avec nous. Nous avons pensé que vous aimeriez savoir que votre article a été expédié. Votre commande est ainsi complète. Votre commande est en route et n\'est plus modifiable. Si vous devez retourner un article dans cet envoi ou gérer d\'autres commandes, veuillez visiter <a href="https://www.amazon.ca/gp/r.html?C=2JG4V7T7UJ2XJ&amp;K=2U9P9ZOT2WYJ7&amp;M=urn:rtn:msg:2020060211184163c7354fc8904f9a8542fc7a4d40p0na&amp;R=34DFLGQ7HMQ26&amp;T=C&amp;U=https%3A%2F%2Fwww.amazon.ca%2Fgp%2Fcss%2Fyour-orders-access%2Fref%3Dpe_3034960_236395000_FR_TE_oh_bd&amp;H=B5RWKIPB3RNNMPNLH0ABMD0MJIQA&amp;ref_=pe_3034960_236395000_FR_TE_oh_bd" style="color:#006699">Vos commandes</a> sur Amazon.ca. </p></td></tr><style type="text/css">\r\n<!--\r\n#topAmabotBannerWrapper\r\n\t{padding:0px 0px 0px 0px}\r\n#topAmabotBannerWrapper td\r\n\t{vertical-align:middle}\r\n#topAmabotBannerWrapper table\r\n\t{border-spacing:0}\r\n.noColorAndTextDecoration a\r\n\t{color:#000!important;\r\n\ttext-decoration:none!important}\r\n#topAmabotBannerBackgroundTable\r\n\t{border-top:3px solid rgb(256,256,256);\r\n\tbackground-color:#efefef;\r\n\twidth:100%}\r\n#topAmabotBannerLeftImage\r\n\t{width:0%;\r\n\tpadding:9px 8px 9px 15px}\r\n#topAmabotBannerTextArea\r\n\t{padding:9px 0 9px 0;\r\n\twidth:100%}\r\n#topAmabotBannerHeader\r\n\t{font:bold 14px Arial,sans-serif;\r\n\tcolor:#333}\r\n#topAmabotBannerHeaderClickable\r\n\t{font:bold 14px Arial,sans-serif;\r\n\tcolor:#069}\r\n#topAmabotBannerBodyPrefixClickable\r\n\t{font:bold 14px Arial,sans-serif;\r\n\tcolor:#069}\r\n#topAmabotBannerBodyPrefix\r\n\t{font:14px Arial,sans-serif;\r\n\tcolor:#333}\r\n#topAmabotBannerBody\r\n\t{font:14px Georgia,serif;\r\n\tline-height:1.2;\r\n\tcolor:#333}\r\n#topAmabotBannerBodyEmphasized\r\n\t{font:14px Georgia,serif;\r\n\tline-height:1.2;\r\n\tfont-style:italic;\r\n\tcolor:#333}\r\n-->\r\n</style><tr><td colspan="2" style="padding:0 20px; width:640px"><table cellspacing="0" cellpadding="0" style="border-top:3px solid #2d3741; width:640px"><tbody><tr><td valign="top" style="font:14px Arial,san-serif; padding:11px 0 14px 18px; width:280px; background-color:#efefef"><span style="color:#666">Votre date de livraison garantie est :</span> <br><p style="margin:2px 0 9px 0"><strong>vendredi 5 juin</strong> </p><a href="https://www.amazon.ca/gp/r.html?C=2JG4V7T7UJ2XJ&amp;K=2U9P9ZOT2WYJ7&amp;M=urn:rtn:msg:2020060211184163c7354fc8904f9a8542fc7a4d40p0na&amp;R=5Z5BGL6V1OL7&amp;T=C&amp;U=https%3A%2F%2Fwww.amazon.ca%2Fgp%2Fcss%2Fshiptrack%2Fview.html%2Fref%3Dpe_3034960_236395000_FR_TE_typ%3Fie%3DUTF8%26addressID%3Dmhrhprjqnjp%26latestArrivalDate%3D1591412400%26orderID%3D701-1371851-7627833%26shipmentDate%3D1591096266%26orderingShipmentId%3D35227926721001%26packageId%3D1&amp;H=XJUR7MXUJYFBE282WFWFGAPD3C8A&amp;ref_=pe_3034960_236395000_FR_TE_typ"><img alt="Suivez votre colis" border="0" height="26" id="trackYourPackage" src="https://images-na.ssl-images-amazon.com/images/G/15//trackYourPackage._V362086629_.png" width="149" style="font-size:13px"> </a></td><td valign="top" style="font:14px Arial,san-serif; padding:11px 18px 14px 18px; width:280px; background-color:#efefef"><span style="color:#666">Votre commande a été envoyée à :</span><br><p style="margin:2px 0"><strong>John<br>Montréal, QC </strong></p></td></tr><tr><td colspan="2" style="font-size:10px; color:#666; padding:0 10px 20px 10px; line-height:16px; width:640px"><p style="margin:10px 0 0 0; font:11px/16px Arial,sans-serif; color:#333">Votre colis est expédié par PUROLATOR et le numéro de suivi est TBK001164017. Selon le mode de livraison que vous avez choisi, il peut s\'écouler jusqu\'à 24 heures avant que votre numéro de suivi ne renvoie des informations. </p></td></tr></tbody></table></td></tr><tr><td colspan="2" style="width:640px"><p style="font:18px Arial,sans-serif; color:#cc6600; border-bottom:1px solid #ccc; margin:10 20px 3px 20px; padding:0 0 3px 0">Récapitulatif de la commande </p></td></tr><tr><td colspan="2" class="shipmentDetails"><table width="560" cellspacing="0" cellpadding="0"><tbody><tr><td align="center" valign="top" style="width:150px; height:115px"><a href="https://www.amazon.ca/gp/r.html?C=2JG4V7T7UJ2XJ&amp;K=2U9P9ZOT2WYJ7&amp;M=urn:rtn:msg:2020060211184163c7354fc8904f9a8542fc7a4d40p0na&amp;R=376SMQIEZOLQT&amp;T=C&amp;U=https%3A%2F%2Fwww.amazon.ca%2Fdp%2FB01CTRKO6Q%2Fref%3Dpe_3034960_236395000_FR_TE_dp_i1&amp;H=FMQWNFL5B9BSH97UQMX1SVI3AX8A&amp;ref_=pe_3034960_236395000_FR_TE_dp_i1" title="ItemImage" style="margin:0 20px 0 0"><img border="0" id="asin" src="https://images-na.ssl-images-amazon.com/images/I/41To5GafVnL._SCLZZZZZZZ__SY115_SX115_.jpg" style="margin:0 0 14px 0"></a> </td><td valign="top" style="color:#666; padding:10px 10px 0 10px; width:310px; height:115px"><p style="margin:0 0 0 7px; padding:0"><a href="https://www.amazon.ca/gp/r.html?C=2JG4V7T7UJ2XJ&amp;K=2U9P9ZOT2WYJ7&amp;M=urn:rtn:msg:2020060211184163c7354fc8904f9a8542fc7a4d40p0na&amp;R=BWIPNJDSMYQF&amp;T=C&amp;U=https%3A%2F%2Fwww.amazon.ca%2Fdp%2FB01CTRKO6Q%2Fref%3Dpe_3034960_236395000_FR_TE_dp_1&amp;H=SUHSBRWSZDMZNDY11TSWVIANOOUA&amp;ref_=pe_3034960_236395000_FR_TE_dp_1" style="font:14px Arial,sans-serif; text-decoration:none; color:#006699">REEHUT 1/2-Inch Extra Thick High Density NBR Exercise Yoga Mat for Pilates, Fitness &amp; Workout w/Carrying Strap (Black) </a><br><span style="font:12px Arial,sans-serif">Vendu par Fascinating Deal </span></p></td><td align="right" valign="top" style="font:14px Arial,san-serif; padding:10px 0 0 0; width:100px; height:115px"><strong>CDN$ 49.99</strong> </td></tr><tr><td colspan="3" style="border-top:1px solid rgb(234,234,234); padding:0pt 0pt 16px; width:560px">&nbsp; </td></tr><tr><td colspan="2" align="right" valign="top" class="chargeDescription" style="font:12px/18px Arial,sans-serif; padding:0 10px 0 0; color:rgb(51,51,51); width:460px">Sous-total de la commande (article(s)) : </td><td align="right" valign="top" class="chargeAmount" style="font:12px/18px Arial,sans-serif; color:rgb(51,51,51); width:100px">CDN$ 49.99 </td></tr><tr><td colspan="2" align="right" valign="top" class="chargeDescription" style="font:12px/18px Arial,sans-serif; padding:0 10px 0 0; color:rgb(51,51,51); width:460px">Expédition et manutention : </td><td align="right" valign="top" class="chargeAmount" style="font:12px/18px Arial,sans-serif; color:rgb(51,51,51); width:100px">CDN$ 0.00 </td></tr><tr><td colspan="2" align="right" valign="top" class="chargeDescription" style="font:12px/18px Arial,sans-serif; padding:0 10px 0 0; color:rgb(51,51,51); width:460px">Estimation de la TPS/TVH : </td><td align="right" valign="top" class="chargeAmount" style="font:12px/18px Arial,sans-serif; color:rgb(51,51,51); width:100px">CDN$ 0.00 </td></tr><tr><td colspan="2" align="right" valign="top" class="chargeDescription" style="font:12px/18px Arial,sans-serif; padding:0 10px 0 0; color:rgb(51,51,51); width:460px">Estimation de la TVP/TVQ : </td><td align="right" valign="top" class="chargeAmount" style="font:12px/18px Arial,sans-serif; color:rgb(51,51,51); width:100px">CDN$ 0.00 </td></tr><tr><td colspan="2" align="right" valign="top" style="font:14px Arial,sans-serif; padding:10px 10px 10px 0; color:#333; width:460px">Total : </td><td align="right" valign="top" style="color:#333; font:14px Arial,sans-serif; padding:10px 0 5px 0; color:#333; width:100px"><strong>CDN$ 49.99</strong> </td></tr><tr><td colspan="2" align="right" valign="top" class="chargeDescription" style="font:12px/18px Arial,sans-serif; padding:0 10px 0 0; color:rgb(51,51,51); width:460px">Payé par Visa : </td><td align="right" valign="top" class="chargeAmount" style="font:12px/18px Arial,sans-serif; color:rgb(51,51,51); width:100px">CDN$ 49.99 </td></tr></tbody></table></td></tr><tr><td colspan="2" style="padding:0 20px; line-height:22px; width:640px"><p style="border-top:1px solid #ccc; padding:20px 0 0 0">Les retours sont faciles. Visitez notre <a href="https://www.amazon.ca/gp/f.html?C=2JG4V7T7UJ2XJ&amp;K=2U9P9ZOT2WYJ7&amp;M=urn:rtn:msg:2020060211184163c7354fc8904f9a8542fc7a4d40p0na&amp;R=3UPFUU5PEPUOX&amp;T=C&amp;U=https%3A%2F%2Fwww.amazon.ca%2Fgp%2Fcss%2Freturns%2Fhomepage.html%2Fref%3Dpe_3034960_236395000_FR_TE_r&amp;H=5D5S3NDCX5G7O1JFOWX7IV1W3ROA&amp;ref_=pe_3034960_236395000_FR_TE_r" style="color:#006699">Service de retours en ligne</a>. <br>Si vous avez besoin d\'aide avec votre commande, veuillez visiter le <a href="https://www.amazon.ca/gp/f.html?C=2JG4V7T7UJ2XJ&amp;K=2U9P9ZOT2WYJ7&amp;M=urn:rtn:msg:2020060211184163c7354fc8904f9a8542fc7a4d40p0na&amp;R=26VOW8IHTC3SZ&amp;T=C&amp;U=https%3A%2F%2Fwww.amazon.ca%2Faide%3Fref_%3Dpe_3034960_236395000_FR_TE_cs&amp;H=LDALUADWGFJBODKHLZOQS9RR8QGA&amp;ref_=pe_3034960_236395000_FR_TE_cs" style="color:#006699">Service à la clientèle</a>. </p></td></tr><tr><td colspan="2" style="padding:0 20px 0 20px; line-height:22px; width:640px"><p style="margin:10px 0; padding:0 0 20px 0; border-bottom:1px solid #eaeaea">Nous espérons vous revoir bientôt!<br><span style="font:14px Arial,san-serif"><strong>Amazon.ca</strong> </span></p></td></tr><tr><td colspan="2" style="font-size:10px; color:#666; padding:0 20px 20px 20px; line-height:16px; width:640px"><p>Ce courriel a été envoyé depuis une adresse de notification seulement qui ne peut accepter de courriels entrants. Veuillez ne pas répondre à ce message.</p><p>Vous pouvez consulter votre facture <a href="https://www.amazon.ca/gp/r.html?C=2JG4V7T7UJ2XJ&amp;K=2U9P9ZOT2WYJ7&amp;M=urn:rtn:msg:2020060211184163c7354fc8904f9a8542fc7a4d40p0na&amp;R=CZ2XHCQTRY67&amp;T=C&amp;U=https%3A%2F%2Fwww.amazon.ca%2Fgp%2Fcss%2Fsummary%2Fprint.html%3ForderID%3D701-1371851-7627833%26ref_%3Dpe_3034960_236395000_TE_inv&amp;H=S6AY9YDILHKTWKAGYDBAAQGJNF0A&amp;ref_=pe_3034960_236395000_TE_inv">ici </a>.</p></td></tr></tbody></table><img width="1" height="1" src="https://www.amazon.ca/gp/r.html?C=2JG4V7T7UJ2XJ&amp;K=2U9P9ZOT2WYJ7&amp;M=urn:rtn:msg:2020060211184163c7354fc8904f9a8542fc7a4d40p0na&amp;R=2M7IW646LANSK&amp;T=E&amp;U=https%3A%2F%2Fimages-na.ssl-images-amazon.com%2Fimages%2FG%2F01%2Fnav%2Ftransp.gif&amp;H=Y4SQDIUUCBV7896S5CVD8S3UKQYA&amp;ref_=pe_3034960_236395000_open"> </body></html>';

describe('finds price', () => {
  test(`from AMAZON order`, () => {
    const result = evaluateEmail(
      'Thank you for your order!',
      'shipment-tracking@amazon.ca',
      testMail,
      new Date('2020-04-05T20:00:32Z')
    );
    expect(result.lineItems.length).toBe(1);
    expect(result.lineItems[0].unit).toBe('CAD');
    expect(result.lineItems[0].value).toBe(49.99);
  });
});
